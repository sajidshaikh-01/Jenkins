# Vulnerability Scanning with Trivy & Pushing Images to Docker Hub

---

## 1. What is Vulnerability Scanning?

Vulnerability scanning is the process of identifying **known security vulnerabilities** in:

* OS packages
* Application dependencies
* Container images
* Configuration files

The goal is to **prevent vulnerable software from reaching production**.

---

## 2. What is Trivy?

Trivy is an **open-source vulnerability scanner** by Aqua Security.

It can scan:

* Container images
* File systems
* Git repositories
* Kubernetes clusters
* SBOMs

üëâ Trivy is **very popular in production DevSecOps pipelines**.

---

## 3. Why Trivy is Used in Production

Companies use Trivy because:

* Easy to install and use
* Fast scanning
* Supports CI/CD pipelines
* Detects:

  * OS vulnerabilities
  * Library vulnerabilities
  * Secrets (optional)
  * Misconfigurations

### Interview Line

> "We use Trivy to scan container images for known vulnerabilities before pushing them to the registry or deploying to Kubernetes."

---

## 4. Types of Scans Trivy Performs

### 1Ô∏è‚É£ OS Package Vulnerabilities

* Scans base image packages (Alpine, Ubuntu, Debian)

### 2Ô∏è‚É£ Application Dependency Vulnerabilities

* Java (Maven, Gradle)
* Python (pip)
* Node.js (npm)

### 3Ô∏è‚É£ Image Configuration Issues

* Insecure settings
* Root user usage

### 4Ô∏è‚É£ Secret Scanning (Optional)

* API keys
* Tokens

---

## 5. Trivy Installation (Linux)

```bash
sudo apt-get update
sudo apt-get install wget -y
wget https://github.com/aquasecurity/trivy/releases/latest/download/trivy_0.49.1_Linux-64bit.deb
sudo dpkg -i trivy_0.49.1_Linux-64bit.deb
```

Verify:

```bash
trivy --version
```

---

## 6. Build Docker Image (Example)

```bash
docker build -t myapp:1.0 .
```

---

## 7. Scan Docker Image Using Trivy

```bash
trivy image myapp:1.0
```

### Scan Only High & Critical Vulnerabilities

```bash
trivy image --severity HIGH,CRITICAL myapp:1.0
```

---

## 8. Fail Pipeline on Vulnerabilities (Production Practice)

```bash
trivy image --severity HIGH,CRITICAL --exit-code 1 myapp:1.0
```

Explanation:

* `--exit-code 1` ‚Üí command fails if vulnerabilities found
* Used in **CI/CD pipelines**

---

## 9. Login to Docker Hub

```bash
docker login
```

Enter:

* Docker Hub username
* Password or access token

---

## 10. Tag Docker Image for Docker Hub

Format:

```bash
docker tag <image>:<tag> <dockerhub-username>/<repo-name>:<tag>
```

Example:

```bash
docker tag myapp:1.0 sajidshaikh/myapp:1.0
```

---

## 11. Push Image to Docker Hub

```bash
docker push sajidshaikh/myapp:1.0
```

After push:

* Image is available publicly or privately
* Can be pulled by Kubernetes or CI/CD tools

---

## 12. Recommended Production Flow (IMPORTANT)

```
Build Image
   ‚Üì
Trivy Scan
   ‚Üì
If vulnerabilities found ‚Üí FAIL
   ‚Üì
If clean ‚Üí Push to Docker Hub
   ‚Üì
Deploy to Kubernetes
```

üëâ **Never push unscanned images in production**.

---

## 13. Trivy in Jenkins Pipeline (Conceptual)

```
stage('Build Image')
stage('Trivy Scan')
stage('Push Image')
stage('Deploy')
```

If Trivy fails ‚Üí Pipeline stops automatically.

---

## 14. Best Practices (Production)

* Scan images **before pushing** to registry
* Fail on HIGH and CRITICAL vulnerabilities
* Use minimal base images (Alpine, Distroless)
* Combine Trivy with:

  * SAST (SonarQube)
  * Dependency scanning
* Regularly update base images

---

